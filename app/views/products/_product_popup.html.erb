<div class="mfp-with-anim mfp-hide mfp-dialog mfp-dialog-big clearfix" id="product_quick_view_dialog_<%= product.id %>">

  <div class="row">

    <!-- Preview -->
    <div class="col-md-7">

      <%= render partial: "products/popup/preview", :locals => {product: product} %>

    </div>

    <!-- Shop + Product description -->
    <div class="col-md-5">

      <div class="product-page-meta">

        <%= render partial: "products/popup/introduction", :locals => {product: product} %>

        <div class="gap"></div>

        <%= form_tag add_product_to_orders_path, :method => :patch do %>

            <%= hidden_field_tag 'sku[product_id]', "#{product.id}" %>

            <% if product.decorate.get_mas %>

                <%= render partial: "products/popup/select_quantity", :locals => {product: product} %>

                <ul class="list product-page-meta-info">

                <%= render partial: "products/popup/select_sku", :locals => {product: product} %>

                  <% if product.decorate.get_mas %>

                      <%= render partial: "products/popup/price_details", :locals => {product: product} %>

                  <% end %>

                </ul>

            <% else %>

                <%= submit_tag "#{I18n.t(:not_available, scope: :popular_products)}", :class => 'btn btn-primary btn-lg', :disabled => true %>

            <% end %>
        <% end %>
      </div>


    </div>

  </div>

  <hr/>

  <div class="row">

    <% if user_signed_in? %>

    <div class="col-md-3">
      <div class="dropdown">
        <button class="<%= in_user_collections?(p) ? 'btn-success' : 'btn-primary'  %> btn dropdown-toggle" data-toggle="dropdown" id="dropdown_toggle_<%= product.id %>" type="button">
          <i class="fa fa-heart"></i>
          <%= I18n.t(:add_to_favorite, scope: :popular_products) %>
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu scrollable-menu">
          <% current_user.oCollections.each do |c| %>
          <li>
            <label>
              <%= check_box_tag "collection_checkbox_#{c.id}", c.products.include?(p), c.products.include?(p), { :onclick => "#{generate_toggle_product_in_collection_js(c.id, product.id)}" } %>
              <i class="<%= c.public ? 'fa fa-users' : 'fa fa-user' %>">
                <%= c.name %>
              </i>
            </label>
          </li>
          <% end %>
        </ul>
      </div>

    </div>
    <div class="col-md-3">
      <div class="dropdown">
        <button class="btn btn-primary" data-toggle="dropdown" id="create_and_add_to_collection_dropdown_button_<%= product.id %>">
          <i class="fa fa-share"></i>
          <%= I18n.t(:create_and_add_to_favorite, scope: :popular_products) %>
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li>
            <%= form_tag '#', :style=>'min-width:300px;margin:4px', :id => "create_and_add_to_collection_form_#{product.id}" do %>
            <%= text_field_tag 'collection[name]', nil, :placeholder => "#{I18n.t(:new_favorite, scope: :popular_products)}",  :id => "create_and_add_to_collection_form_input_name_#{product.id}", :autocomplete => :off %>
            <label style="margin:4px">
              <%= check_box_tag 'collection[public]', 'true', :checked => true %>
              <i class="fa fa-users" data-placement="bottom" data-toggle="tooltip" title="public"></i>
            </label>
            <%= hidden_field_tag :product_id, "#{product.id}" %>
            <%= submit_tag I18n.t(:create_favorite, scope: :popular_products), :class => 'btn btn-primary', :onclick => "#{generate_create_and_add_to_collection_js(product.id)}" %>
            <% end %>
          </li>
        </ul>
      </div>
    </div>
    <% end %>
  </div>
  
</div>
