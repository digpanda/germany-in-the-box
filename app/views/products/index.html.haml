:javascript
  $( document ).ready( function () {
    $.widget( 'custom.catcomplete', $.ui.autocomplete, {
      _create: function() {
          this._super();
          this.widget().menu( 'option', 'items', '> :not(.ui-autocomplete-category)' );
      },
      _renderMenu: function( ul, items ) {
          var that = this,
              search_category = '';
          $.each( items, function( index, item ) {
              var li;
              if ( item.sc != search_category ) {
                  ul.append( "<li class='ui-autocomplete-category'>" + item.sc + '</li>' );
                  search_category = item.sc;
              }
              li = that._renderItemData( ul, item );
              if ( item.sc ) {
                  li.attr( 'aria-label', item.sc + ' : ' + item.label );
              }
          });
      }
    });

    $( '#products_search_area' ).catcomplete({
      delay: 1000,
      source: '/products/autocomplete_product_name',
      select: function (a, b) {
        $(this).val(b.item.value);
        $('#search_products_form').submit()
      }
    });
  });

=content_for :search_area do
  = form_tag search_products_path, :method => :post, :id => 'search_products_form', :class => 'search-area form-group' do
    .container
      .row
        .col-md-12.clearfix
          %label
            %i.fa.fa-search
            %span= I18n.t(:search_prompt, scope: :popular_products)
          .search-area-division.search-area-division-input
            =text_field_tag :products_search_area, params[:products_search_area], :placeholder => "#{ I18n.t(:search_placeholder, scope: :popular_products) }", :class => 'form-control'
.container
  - if @products.count == 0
    %h4 Products cannot be found.
  - else
    - @products.each do |p|
      .mfp-with-anim.mfp-hide.mfp-dialog.mfp-dialog-big.clearfix{ :id => "product-quick-view-dialog-#{p.id}"}
        .row
          .col-md-8
            .fotorama{'data-allowfullscreen' => '1', 'data-nav' => 'thumbs', 'data-thumbheight' => '100', 'data-thumbwidth' => '100'}
              =image_tag p.imglg, :alt => 'Image Alternative text',  :title => 'waipio valley'
              =image_tag p.img, :alt => 'Image Alternative text',  :title => 'The Hidden Power of the Heart'
              =image_tag p.img, :alt => 'Image Alternative text',  :title => 'Tcascada'
              =image_tag p.img, :alt => 'Image Alternative text',  :title => 'the best mode of transport here in maldives'
              =image_tag p.img, :alt => 'Image Alternative text',  :title => 'a turn'
          .col-md-4
            .product-page-meta
              -if p.shop
                %h4=link_to "Shop: #{p.shop.name}", p.shop, :target => '_blank'
              %h4= p.name
              %p= p.desc
              = form_tag add_product_to_order_path(p) do
                =submit_tag "$#{p.price} #{I18n.t(:add_to_cart, scope: :popular_products)}", :class => 'btn btn-primary btn-lg btn-block'
              %ul.list.product-page-meta-info
                %li
                  %ul.list.product-page-meta-price-list
                    %li
                      %span.product-page-meta-title List Price
                      %span.product-page-meta-price $1000
                    %li
                      %span.product-page-meta-title Discount
                      %span.product-page-meta-price 77.5%
                    %li
                      %span.product-page-meta-title Savings
                      %span.product-page-meta-price $775
                %li
                  %span.product-page-meta-title Time Left to Buy
                  .countdown.countdown-inline{'data-countdown' => 'Aug 25, 2013 10:45:00'}
                %li
                  %span.product-page-meta-title 5000+ bought
        %hr
        .row
          .col-md-3
            - if user_signed_in?
              .dropdown
                %button.btn.dropdown-toggle{:id => "dropdown_toggle_#{p.id}", 'data-toggle' => 'dropdown', :type => 'button', :class => "#{in_user_collections?(p) ? 'btn-success' : 'btn-primary' }"  }
                  %i.fa.fa-heart
                  = I18n.t(:add_to_favorite, scope: :popular_products)
                  %span.caret
                %ul.dropdown-menu.scrollable-menu
                  - current_user.oCollections.each do |c|
                    %li
                      %label
                        = check_box_tag "collection_checkbox_#{c.id}", c.products.include?(p), c.products.include?(p), { :onclick => "#{generate_toggle_product_in_collection_js(c.id, p.id)}" }
                        %i{ :class => "#{c.public ? 'fa fa-users' : 'fa fa-user'}" }= c.name
            - else
              .dropdown
                %a.btn.btn-default{:href => '#', 'data-toggle' => 'dropdown', 'data-placement' => 'bottom', :title => 'Yu haven\'t signed in' }
                  %i.fa.fa-share
                  = I18n.t(:add_to_favorite, scope: :popular_products)
                  %span.caret
                %ul.dropdown-menu
                  %li{:style=>'min-width:250px'}
                    .col-md-6
                      = link_to I18n.t(:sign_in, scope: :top_menu), user_session_path, :class => 'fa fa-sign-in', :style => 'color:black; text-decoration: underline'
                    .col-md-6
                      = link_to I18n.t(:sign_out, scope: :top_menu),  new_user_registration_path, :class => 'fa fa-edit', :style => 'color:black; text-decoration: underline'
          .col-md-3
            - if user_signed_in?
              .dropdown
                %button.btn.btn-primary{ 'data-toggle' => 'dropdown', :id => "create_and_add_to_collection_dropdown_button_#{p.id}"  }
                  %i.fa.fa-share
                  = I18n.t(:create_and_add_to_favorite, scope: :popular_products)
                  %span.caret
                %ul.dropdown-menu
                  %li
                    = form_tag '#', :style=>'min-width:300px;margin:4px', :id => "create_and_add_to_collection_form_#{p.id}" do
                      = text_field_tag 'collection[name]', nil, :placeholder => "#{I18n.t(:new_favorite, scope: :popular_products)}",  :id => "create_and_add_to_collection_form_input_name_#{p.id}", :autocomplete => :off
                      %label{ :style => 'margin:4px'}
                        = check_box_tag 'collection[public]'
                        %i.fa.fa-users{'data-toggle' => 'tooltip', 'data-placement' => 'bottom', :title => 'public' }
                      = hidden_field_tag :product_id, "#{p.id}"
                      =submit_tag I18n.t(:create_favorite, scope: :popular_products), :class => 'btn btn-primary', :onclick => "#{generate_create_and_add_to_collection_js(p.id)}"
            - else
              .dropdown
                %a.btn.btn-default{:href => '#', 'data-toggle' => 'dropdown', 'data-placement' => 'bottom', :title => 'Yu haven\'t signed in' }
                  %i.fa.fa-share
                  = I18n.t(:create_and_add_to_favorite, scope: :popular_products)
                  %span.caret
                %ul.dropdown-menu
                  %li{:style=>'min-width:250px'}
                    .col-md-6
                      = link_to I18n.t(:sign_in, scope: :top_menu), user_session_path, :class => 'fa fa-sign-in', :style => 'color:black; text-decoration: underline'
                    .col-md-6
                      = link_to  I18n.t(:sign_up, scope: :top_menu),  new_user_registration_path, :class => 'fa fa-edit', :style => 'color:black; text-decoration: underline'
    .row
      .col-md-3
        %aside.sidebar-left
          %div#left_menu
            %ul
              %li#left_menu_header{ :class => 'has-sub active'}
                %a{:href => '#' }
                  %i{ :class => 'fa fa-list' }= I18n.t(:categories, scope: :category)
              - @categories_and_children.keys.each do |c|
                %li{ :class => 'has-sub' }
                  %a{:href => "#{show_products_in_category_path(c.id)}" }
                    %i{ :class => "fa #{c.cssc}" }= ' ' + c.name
                    %span= @categories_and_counters[c]
                  %ul
                    - @categories_and_children[c].each do |cc|
                      %li
                        %a{:href => "#{show_products_in_category_path(cc.id)}" }
                          %i= cc.name
                          %span= @categories_and_counters[cc]
      .col-md-9
        #masonry.row.row-wrap
          - @products.each do |p|
            %a.col-md-3.col-masonry.popup-text{'data-effect' => 'mfp-move-from-top', :href => "#product-quick-view-dialog-#{p.id}",  :shop_link => "#{p.shop ? shop_path(p.shop) : ''}"}
              .product-thumb
                %header.product-header
                  = image_tag  p.img, :alt => p.name, :title => p.name
                  .product-quick-view
                    %span.fa.fa-eye
                .product-inner
                  %h5.product-title= truncate(p.name, :length => 16)
                  .product-desciption= truncate(p.desc, :length => 16)
                  .product-meta
                    %span.product-time
                      %i.fa.fa-clock-o
                      8 days 47 h
                    %ul.product-price-list
                      %li
                        %span.product-price $102
                      %li
                        %span.product-old-price $188
                  %p.product-location
                    %i.fa.fa-map-marker
                    Boston