<div class="mfp-with-anim mfp-hide mfp-dialog mfp-dialog-big clearfix" id="product_quick_view_dialog_<%= product.id %>">
  <div class="row">
    <div class="col-md-7">
      <div class="fotorama" data-allowfullscreen="1" data-nav="thumbs" data-thumbheight="96" data-thumbwidth="96">
        <% product.decorate.get_mas.decorate.all_nonempty_img_fields.each do |f| %>
            <%= image_tag product.decorate.get_mas_img_url(f, :detail) %>
        <% end %>
      </div>
    </div>
    <div class="col-md-5">
      <div class="product-page-meta">
        <% if product.shop %>
            <h4>
              <%= link_to "Shop: #{product.shop.shopname}", product.shop %>
            </h4>
        <% end %>
        <h4>
          <%= product.name %>
        </h4>
        <p>
          <%= truncate(product.desc, :length => 128) %>
        </p>
        <div class="gap"></div>
        <%= form_tag add_product_to_orders_path, :method => :patch do %>
            <%= hidden_field_tag 'sku[product_id]', "#{product.id}" %>
            <% if product.decorate.get_mas %>
                <div class="form-inline">
                  <%= select_tag 'sku[quantity]', options_for_select(1..[Rails.configuration.max_add_to_cart_each_time, product.decorate.get_mas.quantity].min, 1), :class => 'form-control input-lg', :style => 'width:72px', :id => "product_quantity_#{product.id}" %>
                  <%= submit_tag "#{I18n.t(:add_to_cart, scope: :popular_products)}", :class => 'btn btn-primary btn-lg', :disabled => (not enough_inventory(product.decorate.get_mas, 1)) %>
                </div>
                <ul class="list product-page-meta-info">
                  <ul class="list product-page-meta-price-list">
                    <li>
                      <span class="product-page-meta-title">
                        <%= I18n.t(:variant_option, scope: :cart) %>
                      </span>
                      <span class="product-page-meta-price">
                        <%= select_tag 'sku[option_ids]', options_for_select( get_options_for_select(product), product.decorate.get_mas.option_ids.join(',') ), :class => 'form-control variant-option', :id => 'option_ids', :product_id => product.id %>
                      </span>
                    </li>
                  </ul>
                  <% if product.decorate.get_mas %>
                      <li>
                        <ul class="list product-page-meta-price-list">
                          <li>
                          <span class="product-page-meta-title">
                            <%= I18n.t(:price, scope: :popular_products) %>
                          </span>
                          <span class="product-page-meta-price" id="product_price_<%= product.id %>">
                            <%= "#{product.decorate.get_mas.price} #{product.shop.currency.code}" %>
                          </span>
                          </li>
                          <li>
                          <span class="product-page-meta-title">
                            <%= I18n.t(:discount, scope: :popular_products) %>
                          </span>
                          <span class="product-page-meta-price" id="product_discount_<%= product.id %>">
                            <%= "#{product.decorate.get_mas.discount}%" %>
                          </span>
                          </li>
                          <li>
                          <span class="product-page-meta-title">
                            <%= I18n.t(:saving, scope: :popular_products) %>
                          </span>
                          <span class="product-page-meta-price" id="product_saving_<%= product.id %>">
                            <%= "#{product.decorate.get_mas.price * product.decorate.get_mas.discount} #{product.shop.currency.code}" %>
                          </span>
                          </li>
                        </ul>
                      </li>
                      <li>
                        <ul class="list product-page-meta-price-list">
                          <li>
                          <span class="product-page-meta-title">
                            <%= I18n.t(:inventory, scope: :popular_products) %>
                          </span>
                          <span class="product-page-meta-price" id="product_inventory_<%= product.id %>">
                            <%= product.decorate.get_mas.limited ? product.decorate.get_mas.quantity : I18n.t(:unlimited, scope: :popular_products) %>
                          </span>
                          </li>
                        </ul>
                      </li>
                  <% end %>
                </ul>
            <% else %>
                <%= submit_tag "#{I18n.t(:not_available, scope: :popular_products)}", :class => 'btn btn-primary btn-lg', :disabled => true %>
            <% end %>
        <% end %>
      </div>
    </div>
  </div>
  <hr/>
  <div class="row">
    <div class="col-md-3">
      <% if user_signed_in? %>
          <div class="dropdown">
            <button class="<%= in_user_collections?(p) ? 'btn-success' : 'btn-primary'  %> btn dropdown-toggle" data-toggle="dropdown" id="dropdown_toggle_<%= product.id %>" type="button">
              <i class="fa fa-heart"></i>
              <%= I18n.t(:add_to_favorite, scope: :popular_products) %>
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu scrollable-menu">
              <% current_user.oCollections.each do |c| %>
                  <li>
                    <label>
                      <%= check_box_tag "collection_checkbox_#{c.id}", c.products.include?(p), c.products.include?(p), { :onclick => "#{generate_toggle_product_in_collection_js(c.id, product.id)}" } %>
                      <i class="<%= c.public ? 'fa fa-users' : 'fa fa-user' %>">
                        <%= c.name %>
                      </i>
                    </label>
                  </li>
              <% end %>
            </ul>
          </div>
      <% else %>
          <div class="dropdown">
            <a class="btn btn-default" data-placement="bottom" data-toggle="dropdown" href="#" title="Yu haven't signed in">
              <i class="fa fa-heart"></i>
              <%= I18n.t(:add_to_favorite, scope: :popular_products) %>
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <li style="min-width:250px">
                <div class="col-md-6">
                  <%= link_to I18n.t(:sign_in, scope: :top_menu), user_session_path, :class => 'fa fa-sign-in', :style => 'color:black; text-decoration: underline' %>
                </div>
                <div class="col-md-6">
                  <%= link_to I18n.t(:sign_up, scope: :top_menu),  new_user_registration_path, :class => 'fa fa-edit', :style => 'color:black; text-decoration: underline' %>
                </div>
              </li>
            </ul>
          </div>
      <% end %>
    </div>
    <div class="col-md-3">
      <% if user_signed_in? %>
          <div class="dropdown">
            <button class="btn btn-primary" data-toggle="dropdown" id="create_and_add_to_collection_dropdown_button_<%= product.id %>">
              <i class="fa fa-share"></i>
              <%= I18n.t(:create_and_add_to_favorite, scope: :popular_products) %>
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <%= form_tag '#', :style=>'min-width:300px;margin:4px', :id => "create_and_add_to_collection_form_#{product.id}" do %>
                    <%= text_field_tag 'collection[name]', nil, :placeholder => "#{I18n.t(:new_favorite, scope: :popular_products)}",  :id => "create_and_add_to_collection_form_input_name_#{product.id}", :autocomplete => :off %>
                    <label style="margin:4px">
                      <%= check_box_tag 'collection[public]', 'true', :checked => true %>
                      <i class="fa fa-users" data-placement="bottom" data-toggle="tooltip" title="public"></i>
                    </label>
                    <%= hidden_field_tag :product_id, "#{product.id}" %>
                    <%= submit_tag I18n.t(:create_favorite, scope: :popular_products), :class => 'btn btn-primary', :onclick => "#{generate_create_and_add_to_collection_js(product.id)}" %>
                <% end %>
              </li>
            </ul>
          </div>
      <% else %>
          <div class="dropdown">
            <a class="btn btn-default" data-placement="bottom" data-toggle="dropdown" href="#" title="Yu haven't signed in">
              <i class="fa fa-share"></i>
              <%= I18n.t(:create_and_add_to_favorite, scope: :popular_products) %>
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <li style="min-width:250px">
                <div class="col-md-6">
                  <%= link_to I18n.t(:sign_in, scope: :top_menu), user_session_path, :class => 'fa fa-sign-in', :style => 'color:black; text-decoration: underline' %>
                </div>
                <div class="col-md-6">
                  <%= link_to  I18n.t(:sign_up, scope: :top_menu),  new_user_registration_path, :class => 'fa fa-edit', :style => 'color:black; text-decoration: underline' %>
                </div>
              </li>
            </ul>
          </div>
      <% end %>
    </div>
  </div>
</div>
