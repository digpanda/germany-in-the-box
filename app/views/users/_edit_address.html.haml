= javascript_include_tag 'china_city.js'

.row
  %h3.text-center You can configure maximal 3 different addresses.

#add-address-dialog.mfp-with-anim.mfp-hide.mfp-dialog.clearfix
  =form_for @address do |f|
    .form-group
      %h4 Your New Address
    .form-group
      = f.text_field :street_building_room, :class => 'form-control', :placeholder => 'Street, Building & Room (*)'
    .city-group
      .form-group
        = f.select :province, options_for_select(ChinaCity.list), {  include_blank: '--省份--' }, { :autocomplete => :off, class: 'form-control city-select city-province' }
      .form-group
        = f.select :city    , [], { include_blank: '--城市--'}, { :autocomplete => :off, class: 'form-control city-select city-city' }
      .form-group
        = f.select :district, [], { include_blank: '--地区--' }, { :autocomplete => :off, class: 'form-control city-select city-district' }
    .form-group
      = f.text_field :country, :value => '中国', :readonly => true, :class => 'form-control', :placeholder => 'Country (*)'
    .form-group
      = f.text_field :zip, :class => 'form-control', :placeholder => 'Zip (*)'
    .form-group
      .checkbox
        %label
          = f.check_box :primary, {:class => 'i-check'}, true, false
          Set Primary
    %input.btn.btn-primary{:type => "submit", :value => "Add Address"}
.row.row-wrap
  - current_user.addresses.each do |a|
    %div.mfp-with-anim.mfp-hide.mfp-dialog.clearfix{ :id => "edit-address-dialog-#{a.id}" }
      = form_for a, :url => address_path(a), :html => { :method => :patch }  do |f|
        .form-group
          %h4 Change Your Address
        .form-group
          = f.text_field :street_building_room, :value=> "#{a.street_building_room}", :class => 'form-control', :placeholder => 'Street, Building & Room (*)'
        .city-group
          .form-group
            = f.select :province, options_for_select(ChinaCity.list, ChinaCity.list.select { |p| p[0] == a.province }[0][1]), {  include_blank: '--省份--' }, { :autocomplete => :off, class: 'form-control city-select city-province' }
          .form-group
            = f.select :city    , options_for_select(ChinaCity.list(ChinaCity.list.select { |p| p[0] == a.province }[0][1]), ChinaCity.list(ChinaCity.list.select { |p| p[0] == a.province }[0][1]).select { |p| p[0] == a.city }[0][1]), { include_blank: '--城市--' }, { :autocomplete => :off, class: 'form-control city-select city-city' }
          .form-group
            = f.select :district, options_for_select(ChinaCity.list(ChinaCity.list(ChinaCity.list.select { |p| p[0] == a.province }[0][1]).select { |p| p[0] == a.city }[0][1]), ChinaCity.list(ChinaCity.list(ChinaCity.list.select { |p| p[0] == a.province }[0][1]).select { |p| p[0] == a.city }[0][1]).select { |p| p[0] == a.district }[0][1]), { include_blank: '--地区--' }, { :autocomplete => :off, class: 'form-control city-select city-district' }
        .form-group
          = f.text_field :country, :value => '中国', :readonly => true, :class => 'form-control', :placeholder => 'Country (*)'
        .form-group
          = f.text_field :zip,      :value=> "#{a.zip}",      :class => 'form-control', :placeholder => 'Zip (*)'
        .form-group
          .checkbox
            %label
              = f.check_box :primary, {:class => 'i-check'}, true, false
              Set Primary
        %input.btn.btn-primary{:type => "submit", :value => "Save Changes"}
    .col-md-4
      .address-box
        = link_to '', address_path(a), method: :delete, data: { confirm: 'Are you certain you want to delete this?' }, "data-placement" => "right", "data-toggle" => "tooltip", class: 'address-box-remove'
        %a.address-box-edit.popup-text{"data-effect" => "mfp-move-from-top", "data-placement" => "right", "data-toggle" => "tooltip", :href => "#edit-address-dialog-#{a.id}", :title => "Edit"}
        %ul
          %li= "Street, Building & Room : #{ a.street_building_room }"
          %li= "District : #{ a.district }"
          %li= "City : #{ a.city }"
          %li= "Province : #{ a.province }"
          %li= "Country : #{ a.country }"
          %li= "Zip : #{ a.zip }"
        .radio
          %label
            = radio_button_tag :primary, a.primary, checked = a.primary, { :disabled => true, :class => 'i-radio' }
            Primary Address
  - if current_user.addresses.count < 3
    .col-md-4
      %a.address-box.address-box-new.popup-text{"data-effect" => "mfp-move-from-top", :href => "#add-address-dialog"}
        .vert-center
          %i.fa.fa-plus.address-box-new-icon
          %p Add New Address
