<!-- <script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script> -->

<script>


function callpay()
{
    if (typeof WeixinJSBridge == "undefined"){
        if( document.addEventListener ){
            document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
        }else if (document.attachEvent){
            document.attachEvent('WeixinJSBridgeReady', jsApiCall);
            document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
        }
    }else{
        jsApiCall();
    }
}


function jsApiCall()
{
      var parameters = {
        timeStamp: "<%= @checkout[:timeStamp] %>", // pay the signature timestamp, note that all the timestamp fields in the microsecond jssdk are both lowercase. But the latest version of the payment background generated by the signature using the timeStamp field name to be capitalized in which the S character
        nonceStr: "<%= @checkout[:nonceStr] %>", // pay the signature random string, not longer than 32 bits
        package: "<%= @checkout[:package] %>", // The prepay_id parameter value returned by the payment interface, such as prepay_id = ***)
        signType: "<%= @checkout[:signType] %>", // signature, default to 'SHA1', use the new payment to be passed 'MD5'
        paySign: "<%= @checkout[:paySign] %>";
      };

       WeixinJSBridge.invoke(
       'getBrandWCPayRequest',
       parameters,
       function(res){
           console.log(res);
           switch(res.err_msg)
           {
               case "ok":
                     console.log('payment made');
                     paymentWasMade = true;
                     break;
               case "cancel":
                     break;
               case "fail":
                     break;
            }
     });
}


 // wx.config({
 //      debug: true, // Enables debugging mode. Return values of all APIs called will be shown on the client. To view the sent parameters, open the log view of developer tools on a computer browser. The parameter information can only be printed when viewed from a computer.
 //      appId: "<%= @checkout["appid"] %>", // Required, unique identifier of the official account
 //      // timestamp: "", // Required, timestamp for the generated signature
 //      nonceStr: "<%= @checkout["nonce_str"] %>", // Required, random string for the generated signature
 //      signature: "<%= @checkout["sign"] %>", // Required, signature. See Appendix 1.
 //      jsApiList: ['ChooseWXPay'] // Required, list of JS APIs to be used. See Appendix 2 for the list of all JS APIs
 // });
 //
 // wx.ready(function(){
 //   console.log('its ready');
 // });
 //
 // wx.error (function(res) {
 //   console.log('error');
 //   console.log(res);
 // });
 //
 // wx.checkJsApi ({
 //     jsApiList: ['ChooseWXPay'], // ​​need to detect the list of JS interface, all JS interface list see Appendix 2,
 //     success: function(res) {
 //       console.log('success checkjsapi');
 //       console.log(res);
 //         // in the form of key-value return, available api Value true, not available as false // such as: {"checkResult": {"chooseImage": true}, "errMsg": "checkJsApi: ok"
 //     }
 // });
 // //
 // wx.chooseWXPay({
 //     timestamp: "<%= @checkout[:timeStamp] %>", // pay the signature timestamp, note that all the timestamp fields in the microsecond jssdk are both lowercase. But the latest version of the payment background generated by the signature using the timeStamp field name to be capitalized in which the S character
 //     nonceStr: "<%= @checkout[:nonceStr] %>", // pay the signature random string, not longer than 32 bits
 //     package: "<%= @checkout[:package] %>", // The prepay_id parameter value returned by the payment interface, such as prepay_id = ***)
 //     signType: "<%= @checkout[:signType] %>", // signature, default to 'SHA1', use the new payment to be passed 'MD5'
 //     paySign: "<%= @checkout[:paySign] %>", // pay the signature
 //     success: function (res) {
 //       console.log("was a success");
 //     },
 //     cancel: function(res) {
 //
 //     }
 // });

</script>
