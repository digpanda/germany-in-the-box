!!!
%html
  %head
    %title RheinManufaktur
    %meta{:content => 'text/html; charset=utf-8', 'http-equiv' => 'Content-Type'}
    %meta{:content => 'RheinManufaktur', :name => 'keywords'}
    %meta{:content => 'RheinManufaktur', :name => 'description'}
    %meta{:content => 'Y. Liu', :name => 'author'}
    %meta{:content => 'width=device-width, initial-scale=1.0', :name => 'viewport'}

    = csrf_meta_tag

    = javascript_include_tag 'jquery.js'
    = javascript_include_tag 'jquery_ujs.js'
    = javascript_include_tag 'jquery-ui/widget.js'
    = javascript_include_tag 'jquery-ui/autocomplete.js'

    = javascript_include_tag 'validator.js'

    = javascript_include_tag 'leftmenu/script.js'

    = javascript_include_tag 'achat.js'

    = javascript_include_tag 'bootstrap-datepicker/core.js'
    = javascript_include_tag 'bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.js'
    = javascript_include_tag 'bootstrap-datepicker/locales/bootstrap-datepicker.de.js'

    = stylesheet_link_tag 'couponia/css/boostrap.css'
    = stylesheet_link_tag 'couponia/css/font_awesome.css'
    = stylesheet_link_tag 'couponia/css/styles.css'

    = stylesheet_link_tag 'couponia/css/mystyles.css'

    = stylesheet_link_tag 'leftmenu/style.css'

    = stylesheet_link_tag 'achat.css'

    = stylesheet_link_tag 'bootstrap-datepicker.css'


    - if session[:login_advice_counter].present?
      = hidden_field_tag :login_advice_counter, "#{session[:login_advice_counter]}"

    - if session[:signup_advice_counter].present?
      = hidden_field_tag :signup_advice_counter, "#{session[:signup_advice_counter]}"

    :javascript
      function validateImgFile(inputFile) {
        var maxExceededMessage = "#{I18n.t(:max_exceeded_message, scope: :image_upload)}";
        var extErrorMessage = "#{I18n.t(:ext_error_message, scope: :image_upload)}";;
        var allowedExtension = ["jpg", "jpeg", "png"];

        var extName;
        var maxFileSize = 1048576;
        var sizeExceeded = false;
        var extError = false;

        $.each(inputFile.files, function() {
          if (this.size && maxFileSize && this.size > maxFileSize) {sizeExceeded=true;};
          extName = this.name.split('.').pop();
          if ($.inArray(extName, allowedExtension) == -1) {extError=true;};
        });
        if (sizeExceeded) {
          window.alert(maxExceededMessage);
          $(inputFile).val('');
        };

        if (extError) {
          window.alert(extErrorMessage);
          $(inputFile).val('');
        };
      }

      #{generate_set_datepicker_lang_js}
  %body
    %nav{:class => "#{for_device_type :desktop do 'navbar-fixed-top' end}" }
      .container
        - for_device_type :desktop do
          %a.shared_header_logo{:href => "#{root_path}"}
            = image_tag  'icons/Logo_gate_L.png', :style => 'width:46px;height:46px'
      %header.main
        .container
          .row
            .col-md-6
              #flexnav-menu-button.flexnav-menu-button
                - for_device_type :tablet, :mobile do
                  %a.shared_header_logo_mobile{:href => "#{root_path}"}
                    = image_tag  'icons/Logo_Gate_M.png', :style => 'width:20px;height:20px'
              - if I18n.locale == :'zh-CN' or (current_user && current_user.role == :customer)
                %ul#flexnav.hidden-xs.nav.nav-pills.flexnav{'data-breakpoint' => '800'}
                  %li{:class => params[:top_menu_active_part] ? (params[:top_menu_active_part] == :home ? 'active' : '') : 'active'}
                    %a{:href => "#{root_path}"}= I18n.t(:start, scope: :top_menu)
                  - get_root_level_categories_from_cache().each do |rc|
                    %li{:class => params[:top_menu_active_part] == :fashion ? 'active' : ''}
                      %a{:href => '#'}= rc.get_locale_name
                      %ul
                        - get_first_level_categories_from_cache(rc).each do |fc|
                          %li
                            - if get_second_level_categories_from_cache(fc).count > 0
                              %a{:href => '#'}= fc.get_locale_name
                              %ul
                                - get_second_level_categories_from_cache(fc).each do |sc|
                                  %li
                                    %a{:href => "#{show_products_in_category_path(sc.id)}"}= sc.get_locale_name
                            - else
                              %a{:href => "#{show_products_in_category_path(fc.id)}" }= fc.get_locale_name
                  %li{:class => params[:top_menu_active_part] == :product ? 'active' : ''}
                    =link_to I18n.t(:popular_product, scope: :top_menu), list_popular_products_path
                  - for_device_type :table, :mobile do
                    %li
                      = form_tag search_products_path, :method => :get, :id => 'search_products_form', :class => 'form-group' do
                        %label
                          %i.fa.fa-search
                          %span= I18n.t(:search_prompt, scope: :popular_products)
                        =text_field_tag :products_search_keyword, params[:products_search_keyword], :placeholder => "#{ I18n.t(:search_placeholder, scope: :popular_products) }", :class => 'form-control'
            .col-md-6
              %ul.login-register
                - if I18n.locale == :'zh-CN' or (current_user && current_user.role == :customer)
                  %li.shopping-cart
                    %a{:href => "#{manage_cart_orders_path}", :title => "#{I18n.t(:my_cart, scope: :top_menu)}"}
                      %i.fa.fa-shopping-cart
                      = for_device_type :desktop do I18n.t(:my_cart, scope: :top_menu) end
                      %span.numberCircle= total_number_of_products
                    .shopping-cart-box
                      -if total_number_of_products > 0
                        - current_orders.each do |s, o|
                          %ul.shopping-cart-items
                            - o.order_items.each do |i|
                              %li
                                %a{:href => "#{manage_cart_orders_path}" }
                                  = image_tag get_uploaded_thumbnail_url(i.sku.img0)
                                  %h5= i.product.name
                                  %span.shopping-cart-item-price= "Subtotal: $#{i.sku.price * i.quantity}"
                      -else
                        %ul.list-inline.text-center
                          %li
                            %a{:href => "#{manage_cart_orders_path}"}
                              %i
                              = I18n.t(:empty_cart, scope: :top_menu)

                - unless current_user
                  %li
                    %a.popup-text{ :id => 'sign_in_link', 'data-effect' => 'mfp-zoom-out', :href => '#login-dialog', :title => "#{I18n.t(:sign_in, scope: :top_menu)}"}
                      %i.fa.fa-sign-in
                      = for_device_type :desktop do I18n.t(:sign_in, scope: :top_menu) end
                  - if I18n.locale == :'zh-CN' or (current_user && current_user.role == :customer)
                    %li
                      %a.popup-text{:id => 'sign_up_link', 'data-effect' => 'mfp-zoom-out', :href => '#register-dialog', :title => "#{I18n.t(:sign_up, scope: :top_menu)}"}
                        %i.fa.fa-edit
                        = for_device_type :desktop do I18n.t(:sign_up, scope: :top_menu) end
                - else
                  - if current_user.role != :shopkeeper
                    %li
                      %a{:href => "#{edit_user_path(current_user, :user_info_edit_part => :edit_collection)}",  :title => "#{I18n.t(:my_collection, scope: :top_menu)}"}
                        %i.fa.fa-heart
                        = for_device_type :desktop do I18n.t(:my_collection, scope: :top_menu) end
                - if current_user
                  - if current_user.role == :customer
                    = render 'users/menu_customer'
                  - elsif current_user.role == :shopkeeper
                    = render 'users/menu_shopkeeper'
                  - elsif current_user.role == :admin
                    = render 'users/menu_admin'
                - if I18n.locale == :'zh-CN' or (current_user && current_user.role == :customer)
                  %li.dropdown
                    %a{:href => '#', 'data-toggle' => 'dropdown',  :title => "#{I18n.t(:language, scope: :top_menu)}" }
                      %i.fa.fa-language
                      = for_device_type :desktop do I18n.t(:language, scope: :top_menu) end
                      %span.caret
                    %ul.dropdown-menu
                      %li
                        = link_to I18n.t(:chinese, scope: :top_menu), set_session_locale_path(:'zh-CN')
                      %li
                        = link_to I18n.t(:german, scope: :top_menu),  set_session_locale_path(:de)

      #login-dialog.mfp-with-anim.mfp-hide.mfp-dialog.clearfix.open-popup-link
        %i.fa.fa-sign-in.dialog-icon
        - if session[:login_advice_counter] and flash[:error].present?
          %h5{ :style => 'color:red' }= flash[:error]
        - elsif session[:login_advice_counter] and flash[:info].present?
          %h5{ :style => 'color:blue' }= flash[:info]
        - else
          %h3= I18n.t(:header, scope: :sign_in_dialog)
          %h5= I18n.t(:title, scope: :sign_in_dialog)
        = form_tag user_session_path, :method => :post, :class => 'dialog-form', 'data-toggle': 'validator'  do
          .form-group
            %label= I18n.t(:email, scope: :sign_in_dialog)
            = email_field_tag 'user[email]',  nil, :class => 'form-control', :placeholder => 'email@domain.com', :required => true
            %div.help-block.with-errors
          .form-group
            %label= I18n.t(:password, scope: :sign_in_dialog)
            = password_field_tag 'user[password]', nil, :class => 'form-control', :placeholder => I18n.t(:password, scope: :sign_up_dialog), :required => true
          - if session[:login_advice_counter].present? and session[:login_advice_counter] >= Rails.configuration.login_failure_limit
            .form-inline
              .form-group
                = text_field_tag :captcha, '', :autocomplete => :off,  placeholder: I18n.t(:captcha, scope: :sign_up_dialog), :required => true, :minLength => 4, :maxLength => 4, :class => 'form-control'
              .form-group
                = captcha_tag
          .checkbox
            %label
              %input{:type => 'checkbox'}
              = I18n.t(:remember_me, scope: :sign_in_dialog)
          = submit_tag I18n.t(:sign_in, scope: :sign_in_dialog), :class => 'btn btn-primary'
        %ul.dialog-alt-links
          %li
            %a.popup-text{'data-effect' => 'mfp-zoom-out', :href => '#register-dialog'}= I18n.t(:not_member_yet, scope: :sign_in_dialog)
          %li
            %a.popup-text{'data-effect' => 'mfp-zoom-out', :href => '#password-recover-dialog'}= I18n.t(:forgot_password, scope: :sign_in_dialog)
      #register-dialog.mfp-with-anim.mfp-hide.mfp-dialog.clearfix
        %i.fa.fa-edit.dialog-icon
        - if session[:signup_advice_counter] and flash[:error].present?
          %h5{ :style => 'color:red' }= flash[:error]
        - elsif session[:signup_advice_counter] and flash[:info].present?
          %h5{ :style => 'color:blue' }= flash[:info]
        - else
          - for_device_type :desktop do
            %h3= I18n.t(:header, scope: :sign_up_dialog)
            %h5= I18n.t(:title, scope: :sign_up_dialog)
          - for_device_type :mobile, :tablet do
            %h4= I18n.t(:header, scope: :sign_up_dialog)
        = form_tag user_registration_path, :method => :post, :class => 'dialog-form', 'data-toggle': 'validator' do
          - for_device_type :desktop do
            .form-group
              = text_field_tag 'user[username]', nil, :class => 'form-control', :placeholder => I18n.t(:username, scope: :sign_up_dialog), :required => true
            .form-group
              = email_field_tag 'user[email]', nil, :class => 'form-control', :placeholder => I18n.t(:email, scope: :sign_up_dialog), :required => true
            .form-group
              = password_field_tag 'user[password]', nil, :class => 'form-control', :placeholder => I18n.t(:password, scope: :sign_up_dialog), :required => true, :minLength => Rails.configuration.min_password_length
              %div.help-block.with-errors
            .form-group
              = password_field_tag 'user[password_confirmation]', nil, :class => 'form-control', :placeholder => I18n.t(:password_confirmation, scope: :sign_up_dialog), 'data-match' => '#user_password'
              %div.help-block.with-errors
            .form-inline
              .form-group
                = text_field_tag 'user[birth]', nil, :class => 'form-control date-picker', placeholder: I18n.t(:birthday, scope: :edit_personal), 'data-provide': 'datepicker', 'data-date-format': 'yyyy-mm-dd', :required => true
              .form-group.col-md-offset-1
                %label.radio-inline
                  = radio_button_tag 'user[gender]', 'm'
                  = I18n.t(:'genderize.name.masculine')
                %label.radio-inline
                  = radio_button_tag 'user[gender]', 'f', :checked => true
                  = I18n.t(:'genderize.name.feminine')
            .form-inline
              .form-group
                = text_field_tag :captcha, nil, :autocomplete => :off, placeholder: I18n.t(:captcha, scope: :sign_up_dialog), :class => 'form-control', :style => 'margin-right:14px', :required => true, :minLength => 4, :maxLength => 4
              .form-group
                = captcha_tag
            = submit_tag I18n.t(:sign_up, scope: :sign_up_dialog), :class => 'btn btn-primary'
          - for_device_type :mobile, :tablet do
            = text_field_tag 'user[username]', nil, :class => 'form-control', :placeholder => I18n.t(:username, scope: :sign_up_dialog), :required => true
            = email_field_tag 'user[email]', nil, :class => 'form-control', :placeholder => I18n.t(:email, scope: :sign_up_dialog), :required => true
            = password_field_tag 'user[password]', nil, :class => 'form-control', :placeholder => I18n.t(:password, scope: :sign_up_dialog), :required => true, :minLength => 8
            %div.help-block.with-errors
            = password_field_tag 'user[password_confirmation]', nil, :class => 'form-control', :placeholder => I18n.t(:password_confirmation, scope: :sign_up_dialog), 'data-match' => '#user_password'
            %div.help-block.with-errors
            .input-group
              = text_field_tag 'user[birth]', nil, :class => 'form-control date-picker', placeholder: I18n.t(:birthday, scope: :edit_personal), 'data-provide': 'datepicker', 'data-date-format': 'yyyy-mm-dd', :style => 'width:120px;margin-right:8px'
              %label.radio-inline
                = radio_button_tag 'user[gender]', 'm'
                = I18n.t(:'genderize.name.masculine')
              %label.radio-inline
                = radio_button_tag 'user[gender]', 'f', :checked => true
                = I18n.t(:'genderize.name.feminine')
            .input-group
              = captcha_tag
              = text_field_tag :captcha, '', :autocomplete => :off, :placeholder => I18n.t(:captcha, scope: :sign_up_dialog), :class => 'form-control', :required => true, :minLength => 4, :maxLength => 4
            = submit_tag I18n.t(:sign_up, scope: :sign_up_dialog), :class => 'btn btn-primary'
        %ul.dialog-alt-links
          %li
            %a.popup-text{'data-effect' => 'mfp-zoom-out', :href => '#login-dialog'}= I18n.t(:already_member, scope: :sign_up_dialog)
      #password-recover-dialog.mfp-with-anim.mfp-hide.mfp-dialog.clearfix
        %i.icon-retweet.dialog-icon
        %h3= I18n.t(:header, scope: :password_recovery_dialog)
        %h5= I18n.t(:title, scope: :password_recovery_dialog)
        %form.dialog-form{'data-toggle': 'validator'}
          %label.control-label= I18n.t(:email, scope: :password_recovery_dialog)
          %input.form-control.span12{:placeholder => 'email@domain.com', :type => 'email', :required => true}
          %input.btn.btn-primary{:type => 'submit', :value => I18n.t(:ok, scope: :password_recovery_dialog)}
      #agb-dialog.mfp-with-anim.mfp-hide.mfp-dialog.mfp-dialog-big.clearfix
        %br
        .text-center
          %h3
            %span.label.label-primary= I18n.t(:agb, scope: :edit_shop)
        %br
        %textarea{ :class => 'form-control', :rows => '8'}= 'AGB'

      - if @show_search_area.present? and @show_search_area
        =yield :search_area

    - for_device_type :desktop do
      - if @show_search_area.present? and @show_search_area
        .row{ :style => 'height: 140px' }
      - else
        .row{ :style => 'height: 80px' }

    - for_device_type :tablet, :mobile do
      .row{ :style => 'height: 30px' }

    - for_device_type :desktop, :tablet do
      .row
        .col-md-3.pull-right
          - if flash[:error]
            .alert.alert-danger.fade.in{:role => 'alert'}
              %a.close{'aria-label' => 'close', 'data-dismiss' => 'alert', :href => '#'} &times;
              = flash[:error]
          - elsif flash[:info]
            .alert.alert-info.fade.in{:role => 'alert'}
              %a.close{'aria-label' => 'close', 'data-dismiss' => 'alert', :href => '#'} &times;
              = flash[:info]
          - elsif flash[:warning]
            .alert.alert-warning.fade.in{:role => 'alert'}
              %a.close{'aria-label' => 'close', 'data-dismiss' => 'alert', :href => '#'} &times;
              = flash[:warning]
          - elsif flash[:success]
            .alert.alert-success.fade.in{:role => 'alert'}
              %a.close{'aria-label' => 'close', 'data-dismiss' => 'alert', :href => '#'} &times;
              = flash[:success]

    .container{:style => 'min-height:400px'}
      = yield

    .gap

%footer.main
  .footer-top-area
    .container
      .row.row-wrap
        .col-xs-6.col-sm-2.col-md-2
          - if I18n.locale == :'zh-CN' or (current_user && current_user.role == :customer)
            %a{:href => '#'}
              = image_tag  'icons/Logo_laiyinn_g.png'
            %h5{ :style => 'padding-top:25px; color:#565a5c' }=I18n.t(:contact_us, scope: :footer)
            %h5=link_to 'customer@laiyinn.com', 'mailto:customer@laiyinn.com', :style => 'color:#49d2be'            

          - elsif user_signed_in? && current_user.role == :shopkeeper
            %a{:href => '#'}
              = image_tag  'icons/Logo_RM_g.png'
            %h5{ :style => 'padding-top:25px; color:#565a5c' }=I18n.t(:contact_us, scope: :footer)
            %h5=link_to 'shop@rhein-manufaktur.eu', 'mailto:shop@rhein-manufaktur.eu', :style => 'color:#49d2be'

          - elsif I18n.locale == :de
            %a{:href => '#'}
              = image_tag  'icons/Logo_RM_g.png'
            %h5{ :style => 'padding-top:25px; color:#565a5c' }=I18n.t(:contact_us, scope: :footer)
            %h5=link_to 'shop@rhein-manufaktur.eu', 'mailto:shop@rhein-manufaktur.eu', :style => 'color:#49d2be'
            

        .col-xs-6.col-sm-4.col-md-4
          %h4= I18n.t(:recent_news, scope: :footer)
          %ul.thumb-list
            %li
              .thumb-list-item-caption
                %p.thumb-list-item-meta 13-01-2016
                %h5.thumb-list-item-title
                  %a{:href => '#'}= I18n.t(:news_ihk_titel, scope: :footer)
                %p.thumb-list-item-desciption= I18n.t(:news_ihk, scope: :footer).html_safe

        .col-xs-6.col-sm-4.col-md-2.col-md-offset-1
          %h4= I18n.t(:rheinmanufaktur, scope: :footer)
          -if user_signed_in? && current_user.role == :shopkeeper
            %h5=link_to I18n.t(:terms_conditions, scope: :footer), '/pages/agb', :target => 'blank'
            %h5=link_to I18n.t(:privarcy_statement, scope: :footer), '/pages/privacy', :target => 'blank'
            %h5=link_to I18n.t(:imprint, scope: :footer), '/pages/imprint', :target => 'blank'
            -#%h5=link_to I18n.t(:guidelines, scope: :footer), '#', :style => 'color: gray; text-decoration: underline'
            -#%h5=link_to I18n.t(:press_portal, scope: :footer), '#'
            -#%h5=link_to I18n.t(:career, scope: :footer), '#', :style => 'color: gray; text-decoration: underline'
          - elsif I18n.locale == :'zh-CN' or (current_user && current_user.role == :customer)
            %h5=link_to I18n.t(:vouchers, scope: :footer), '#'
          - elsif I18n.locale == :de
            %h5=link_to I18n.t(:imprint, scope: :footer), '/pages/imprint', :target => 'blank'
          
        .col-xs-6.col-sm-4.col-md-2.col-md-offset-1
          - if user_signed_in? && current_user.role == :shopkeeper
            %h4= I18n.t(:selling, scope: :footer)
            %h5=link_to I18n.t(:shop_application, scope: :shop_application), '#shop_application_index_path', :class => 'popup-text', 'data-effect' => 'mfp-zoom-out'
            %h5=link_to I18n.t(:sell_on_rm, scope: :footer), '/pages/saleguide', :target => 'blank'
            %h5=link_to I18n.t(:fees_invoices, scope: :footer), '/pages/fees', :target => 'blank'
            -#%h5=link_to I18n.t(:seller_faq, scope: :footer), '#'
          - elsif I18n.locale == :'zh-CN' or (current_user && current_user.role == :customer)
            %h4= I18n.t(:buying, scope: :footer)
            %h5=link_to I18n.t(:buyer_faq, scope: :footer), '#'
            %h5=link_to I18n.t(:buyer_in_3_steps, scope: :footer), '#'
            %h5=link_to I18n.t(:vouchers, scope: :footer), '#'
          - elsif I18n.locale == :de
            %h4= I18n.t(:selling, scope: :footer)
            %h5=link_to I18n.t(:shop_application, scope: :shop_application), '#shop_application_index_path', :class => 'popup-text', 'data-effect' => 'mfp-zoom-out'

            

  .footer-copyright
    .container
      .row
        .col-md-4
          %p= I18n.t(:copyright, scope: :footer)
        .col-md-6.col-md-offset-2

    = javascript_include_tag 'couponia/boostrap.min.js'
    = javascript_include_tag 'couponia/countdown.min.js'
    = javascript_include_tag 'couponia/flexnav.min.js'
    = javascript_include_tag 'couponia/magnific.js'
    = javascript_include_tag 'couponia/tweet.min.js'
    = javascript_include_tag 'couponia/fitvids.min.js'
    = javascript_include_tag 'couponia/mail.min.js'
    = javascript_include_tag 'couponia/ionrangeslider.js'
    = javascript_include_tag 'couponia/icheck.js'
    = javascript_include_tag 'couponia/fotorama.js'
    = javascript_include_tag 'couponia/card-payment.js'
    = javascript_include_tag 'couponia/owl-carousel.js'
    = javascript_include_tag 'couponia/masonry.js'
    = javascript_include_tag 'couponia/nicescroll.js'
    = javascript_include_tag 'couponia/custom.js'
